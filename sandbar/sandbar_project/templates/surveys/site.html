{% extends "base.html" %}

{% load js %}
{% load static %}

{% block title %}Sandbar - {{ site.site_name }}{% endblock %}

{% block page_description %}Provides data and plotting tools for sandbar {{ site.site_name }} located at river mile {{ site.river_mile }}{% endblock %}

{% block page_style %}
	{% css "lib/leaflet-0.6.4/leaflet.css" %}
	{% css "css/sandbar_custom.css" %}
{% endblock %}

{% block page_script %}
	<script type="text/javascript">
		var SB = {};
		SB.GDAWS_SERVICE = '{% url "surveys-gdaws" op="" %}';
		SB.GDAWS_SERVICE = SB.GDAWS_SERVICE.slice(0, SB.GDAWS_SERVICE.length - 1);
		SB.AREA_2D_URL = '{% url "surveys-areavolume" %}';
		SB.SITE_AREA_CALC_URL = '{% url "basic_area_info" %}';
	</script>
	
	<script type="text/javascript">
		var PAGE_URL = window.location.pathname;
		
	</script>
	
 	{% js "lib/modernizr.custom.45705.js" %}
	{% js "lib/webshims-stable/js-webshim/minified/polyfiller.js" %}
	{% js "lib/dygraph-combined.js" %}
	{% js "lib/jquery-validation-1.11.1/dist/jquery.validate.min.js" %}
	{% js "lib/mustache.js-master/mustache.js" %}
	{% js "lib/leaflet-0.6.4/leaflet.js" %}
	{% js "lib/leaflet.ajax.js" %}
	
	{% js "js/utils.js" %}
	{% js "js/Config.js" %}
	{% js "js/DateRange.js" %}
	{% js "js/GDAWSFormatUtils.js" %}
	
	{% js "js/SitePlots.js" %}
	{% js "js/TSPlots.js" %}
	{% js "js/SitePageOnReady.js" %}
	{% js "js/SiteParams.js" %}
	{% js "js/SitePlotMap.js" %}
	
	
	<script type="text/javascript">
		$.webshims.polyfill();		
		var map;		
		$(document).ready(function() {
			SB.SitePageOnReady("{{ site.gdaws_site_id }}", "{{ site.id }}");
			map = SB.SitePlotMap("{{ site.geom.x }}","{{ site.geom.y }}");
			var lat_long = map.getCenter(); 
				console.log(map.getCenter().toString());
			return map;	
			//console.log(map);
		});	   
	</script>
	
	<!-- HTML Templates -->
	{% verbatim %}
	<script id="param_template" type="text/html">
		<div class="parameter-group">
			<input id="{{paramName}}-checkbox" type="checkbox" value="{{paramName}}" />
			<label for="{{paramName}}-checkbox" title="{{description.units}}">{{description.displayName}}</label>
			<br />
			<span class="parameter-dates">{{description.beginPosition}} to {{description.endPosition}}</span>
		</div>
	</script>
	<script id="app_param_template" type="text/html">
		{{#wrapperParam}}
		<div id="{{areaParamVal}}-group" class="parameter-group">
			<input id="{{areaParamVal}}-checkbox" type="checkbox" name="sb-param" value="{{areaParamVal}}" />
			<label for="{{areaParamVal}}-checkbox" title="{{areaParamVal}}-title">{{areaParam}}</label>
			<br />
			<span class="parameter-dates">{{minDate}} to {{maxDate}}</span>
			<br />
			{{#wrapperSubParam}}
			<div id="{{areaParamVal}}-subgroup" class="sub-param-group">
				<input id="{{areaParamVal}}-{{subParamValue}}-checkbox" type="checkbox" name="sb-subparam" value="{{subParamValue}}" />
				<label for="{{areaParamVal}}-{{subParamValue}}-checkbox" title="{{areaParamVal}}-{{subParamValue}}-checkbox-title">{{subParamLabel}}</label>			
			</div>
			{{/wrapperSubParam}}
		</div>
		{{/wrapperParam}}
	</script>
	{% endverbatim %}
{% endblock %}

{% block page_content %}
	<h2>{{ site.site_name }} - {{ site.river_mile }} {{ site.river_side }}</h2>
	<div id="page-loading-div" class="loading-div">
		<span>Loading...</span><br /><img src="{{ STATIC_URL }}images/ajax-loader.gif" alt=""/>
	</div>
	<div id="site-page-content" style="display: none;">
		<div class="col-md-4">
			<div id="parameter-selection-div" class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">Parameters</h4>
				</div>
				<form>
				<div class="panel-body">
					<div id="parameter-checkbox-div"></div>
					<div class="parameter-group">
						<label for="start-date">From:&nbsp;</label>
						<input type="date" id="start-date" />
					</div>
					 <div class="parameter-group">
						<label for="end-date">To:&nbsp;</label>
						<input type="date" id="end-date"/>
					</div>
					<div class="parameter-group">
						<label for="ds-min">Minimum Discharge:&nbsp;</label>
						<input type="text" id="ds-min"/>
					</div>
					<div class="parameter-group">
						<label for="ds-max">Maximum Discharge:&nbsp;</label>
						<input type="text" id="ds-max"/>
					</div>
					<button id="update-plots-button" type="button" class="btn btn-primary btn-block">Update Plots</button>
					<div id="parameter-errors" class="alert alert-danger" style="display: none;"></div>
				</div>
				</form>
			</div>
		</div>
		<div class="col-md-5">
			<div id="graphs-panel-div" class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">Plots</h4>
				</div>
				<div id="graphs-div" class="panel-body">
					<div id="gcmrc-plots">
						<div id="graphs-loading-div" class="loading-div well" style="display: none;"><span>Loading...</span><br /><img src="{{ STATIC_URL }}images/ajax-loader.gif" alt=""/></div>
						<div id="cumulSandLoad-graph-div" class="graph-div"></div>
						<div id="discharge-graph-div" class="graph-div"></div>
					</div>
					<div id="sandbar-plots">
						<div id="plots-loading-div" class="loading-div well" style="display: none;"><span>Loading...</span><br /><img src="{{ STATIC_URL }}images/ajax-loader.gif" alt=""/></div>
						<div id="area2d-graph-div" class="graph-div"></div>
						<div id="area3d-graph-div" class="graph-div"></div>
						<div id="volume-graph-div" class="graph-div"></div>
					</div>
				</div>
			</div>		
		</div>
		<div class="col-md-3 item">
			<div id="site-photo-div" class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">Site Photo</h4>
				</div>
				<div id="site-photo">
				<a title="View full size image" href="{% static 'images/'%}{{ site.image_name }}" target="_blank"><img class="photo" src="{% static 'images/'%}{{ site.image_name_med }}" alt="Image for {{ site.site_name }}"></a>
				</div>
			</div>
			<div id="caption">
				{% if site.image_name_small != "" %}
					<p class="caption">Photograph of {{ site.gcmrc_site_id }} taken {{ site.p_month }} {{ site.p_day }}, {{ site.p_year }}. View is from {{ site.photo_from }} side of river looking {{ site.photo_view }} at site. Streamflow is from {{ site.flow_direction }} of image.

				{% endif %}
			</div>
			<div id="site-info-div" class="panel panel-default  full">
				<div class="panel-heading">
					<h4 class="panel-title">Site Map</h4>
				</div>
				<button type="button" id="cMbtn" class="btn btn-primary">
  				Center Map
				</button>
				<div id="site-loc-map-div" class="full">		
				</div>
				<script>
				var myBtn = document.getElementById('site-loc-map-div');

				//add event listener
				myBtn.addEventListener('click', function(event) {
				  map.invalidateSize();
				});
		  		</script>
			</div>
		</div>
	</div>
	<div>
	</div>
	
	<!-- {% js "js/TimeSeriesPlots.js" %} -->
	
{% endblock %}
