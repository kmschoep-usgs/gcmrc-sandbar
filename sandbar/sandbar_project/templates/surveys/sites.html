{% extends "base.html" %}

{% load js %}

{% block title %}Sandbar Monitoring Sites{% endblock %}

{% block page_description %}
Lists and maps all sandbar monitoring sites. 
{% endblock %}

{% block page_style %}
	{% css "lib/Fixed-Header-Table_1.3/css/defaultTheme.css" %}
	{% css "lib/leaflet-0.6.4/leaflet.css" %}
	{% css "css/sandbar_custom.css" %}
	<style type="text/css">

	</style>
{% endblock %}

{% block page_script %}
	{% js "lib/Fixed-Header-Table_1.3/jquery.fixedheadertable.min.js" %}
	{% js "lib/leaflet-0.6.4/leaflet.js" %}
	{% js "js/SiteMarker.js" %}
	
	<script type="text/javascript">
		$(document).ready(function() {
			$('#sites-table-div table').fixedHeaderTable({
				'height' : 400
			});
			
			var map = L.map('sites-map', {
				center: [36.5, -112.0],
				zoom : 7,
				attributionControl: false
			});
			
			var baseLayer = L.tileLayer('http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.png')
			map.addLayer(baseLayer);
			
			var site_markers = [];
			{% for site in site_list %}
				var thisMarker = new SiteMarker([{{ site.site.geom.y }}, {{ site.site.geom.x }}],{
					'title' : '{{ site.site.id }}',
					'siteId' : '{{ site.site.id }}',
					'riseOnHover' : true
				});
				thisMarker.on('mouseover', function(e) {
					var siteRowEl = $('#site-' + this.getSiteId());
					// Go to site page.
				});
				site_markers.push(thisMarker);
				
			{% endfor %}
			
			L.layerGroup(site_markers).addTo(map);
		});
	</script>	
{% endblock %}

{% block page_content %}
	<h2>Sandbar Monitoring Sites</h2>
	<div id="sites-map-div">
		<div id="sites-map" class="well">
		</div>
	</div>
	<div id="sites-table-div" class=".table-responsive">
		<table class="table table-striped table-fixed-header">
			<thead>
				<tr>
					<th></th>
					<th>River Mile</th>
					<th>Site Name</th>
					<th>Survey Data Record</th>
					<th>Daily Photo Record</th>
				</tr>
			</thead>
			<tbody>
				{% for site in site_list %}
					<tr id="site-{{ site.site.id }}">
						<td></td><!-- This will be for the site thumbnail -->
						<td>{{ site.site.river_mile }}</td>
						<td>{{ site.site.site_name }}</td>
						<td>{{ site.survey.min_date }} - {{site.survey.max_date }}</td>
						<td></td>
					</tr>
			{% endfor %}
			</tbody>
		</table>
	</div> 
{% endblock %}
