{% extends "base.html" %}

{% load js %}

{% block title %}Sandbar Monitoring Sites{% endblock %}

{% block page_description %}
Lists and maps all sandbar monitoring sites. 
{% endblock %}

{% block page_style %}
	{% css "lib/Fixed-Header-Table_1.3/css/defaultTheme.css" %}
	{% css "lib/leaflet-0.6.4/leaflet.css" %}
	{% css "css/sandbar_custom.css" %}
	<style type="text/css">

	</style>
{% endblock %}

{% block page_script %}
	{% js "lib/Fixed-Header-Table_1.3/jquery.fixedheadertable.min.js" %}
	{% js "lib/leaflet-0.6.4/leaflet.js" %}
	{% js "js/SiteMarker.js" %}
	
	<script type="text/javascript">
		$(document).ready(function() {
			$('#sites-table-div table').fixedHeaderTable({
				'height' : 400
			});
			
			var map = L.map('sites-map', {
				center: [36.5, -112.0],
				zoom : 7,
				attributionControl: false
			});
			
			var baseLayer = L.tileLayer('http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.png')
			map.addLayer(baseLayer);
			
			var siteMarkers =[];
			$('#sites-table tbody tr').each(function() {
				var siteNameLinkEl = $(this).find('.site-name-cell a');
				var thisMarker = new SiteMarker([$(this).data('geomY'), $(this).data('geomX')], {
					'title' : siteNameLinkEl.html(),
					'siteId' : $(this).data('siteId'),
					'url' : siteNameLinkEl.attr('href'),
					'riseOnHover' : true
				});
				thisMarker.on('click', function(e) {
					location.href = this.getUrl();
				});
				siteMarkers.push(thisMarker);
			});			
			L.layerGroup(siteMarkers).addTo(map);
		});
	</script>	
{% endblock %}

{% block page_content %}
	<h2>Sandbar Monitoring Sites</h2>
	<div id="sites-map-div" class="well">
		<div id="sites-map">
		</div>
	</div>
	<div id="sites-table-div" class=".table-responsive">
		<table id="sites-table" class="table table-striped table-fixed-header">
			<thead>
				<tr>
					<th></th>
					<th>River Mile</th>
					<th>Site Name</th>
					<th>Survey Data Record</th>
					<th>Daily Photo Record</th>
				</tr>
			</thead>
			<tbody>
				{% for site in site_list %}
					<tr data-site-id="{{ site.site.id }}" data-geom-x="{{ site.site.geom.x }}" data-geom-y="{{ site.site.geom.y }}">
						<td></td><!-- This will be for the site thumbnail -->
						<td class="river-mile-cell">{{ site.site.river_mile }}</td>
						<td class="site-name-cell"><a href="{% url 'surveys-site' pk=site.site.id %}">{{ site.site.site_name }}</a></td>
						<td class="survey-date-range-cell">{{ site.survey.min_date }} - {{site.survey.max_date }}</td>
						<td></td>
					</tr>
			{% endfor %}
			</tbody>
		</table>
	</div> 
{% endblock %}
